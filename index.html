<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.0/qrious.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #qr-code { margin: 20px 0; }
        .content-container { margin: 10px 0; }
    </style>
</head>
<body>

    <h1>QR Code Generator</h1>
    <div id="contentInputs">
        <div class="content-container">
            <input type="text" class="content" placeholder="Enter text or URL" required>
            <button class="remove-content" onclick="removeContent(this)">Remove</button>
        </div>
    </div>
    <button id="addContent">Add More Content</button>
    <br>
    <input type="password" id="password" placeholder="Set Password" required>
    <br>
    <input type="color" id="color" value="#000000">
    <input type="number" id="size" value="200" min="100" max="500">
    <button id="generateQRCode">Generate QR Code</button>
    <button id="downloadQR" style="display:none;">Download QR Code</button>
    <div id="qr-code"></div>

    <script>
        let qrCode; // Store the QR code instance

        // Function to add more content input fields
        $(document).ready(function() {
            $('#addContent').click(function() {
                $('#contentInputs').append(`
                    <div class="content-container">
                        <input type="text" class="content" placeholder="Enter text or URL" required>
                        <button class="remove-content" onclick="removeContent(this)">Remove</button>
                    </div>
                `);
            });
        });

        // Function to remove a content input field
        function removeContent(button) {
            $(button).parent('.content-container').remove();
        }

        // Function to process content and generate QR code
        $('#generateQRCode').click(function() {
            const contents = $('.content').map(function() { return $(this).val(); }).get();
            const password = $('#password').val();
            const color = $('#color').val();
            const size = $('#size').val();

            if (contents.length === 0 || password === "") {
                alert("Please enter at least one content and set a password.");
                return;
            }

            // Encrypt the contents
            const encryptedContent = CryptoJS.AES.encrypt(JSON.stringify(contents), password).toString();
            createQRCode(encryptedContent, color, size);
        });

        // Function to create QR code
        function createQRCode(content, color, size) {
            // Clear previous QR code
            $('#qr-code').empty();
            qrCode = new QRious({
                element: document.createElement('canvas'),
                value: content,
                size: size,
                foreground: color
            });
            $('#qr-code').append(qrCode.canvas);
            $('#downloadQR').show().off('click').on('click', function() {
                const link = document.createElement('a');
                link.download = 'qr_code.png';
                link.href = qrCode.toDataURL();
                link.click();
            });
        }

        // Function to prompt for password to decrypt
        function promptForDecryption(encryptedContent) {
            const password = prompt("Enter the password to view the content:");
            try {
                const decryptedContent = decryptContent(encryptedContent, password);
                if (decryptedContent) {
                    alert("Decrypted Content: " + decryptedContent);
                }
            } catch (error) {
                console.error("Decryption error:", error);
                alert("Incorrect password or decryption error.");
            }
        }

        // Function to decrypt content
        function decryptContent(encryptedContent, password) {
            const bytes = CryptoJS.AES.decrypt(encryptedContent, password);
            const decrypted = bytes.toString(CryptoJS.enc.Utf8);
            if (!decrypted) throw new Error('Decryption failed');
            return JSON.parse(decrypted);
        }
    </script>
</body>
</html>
